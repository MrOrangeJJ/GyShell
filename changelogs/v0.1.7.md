# v0.1.7 Release Notes

### English

**Mention Input Behavior**

- **Updated `@mention` trigger behavior**: mention suggestions now appear whenever `@` is typed, without requiring a preceding space.
- **Kept mention serialization/parsing protocol unchanged**: only selected mention tags are converted to `[MENTION_...]` labels; plain `@` text remains plain text.
- **Fixed adjacent mention deletion behavior**: when two mention labels are consecutive, deleting in re-select mode now removes only the currently targeted label instead of removing both at once.

**Backend Gateway Decoupling**

- **Refactored Gateway into transport-agnostic runtime core**: extracted transport fan-out into `TransportHub` and removed direct Electron transport coupling from `GatewayService`.
- **Split Electron IPC surface into dedicated adapter**: moved IPC registration to `ElectronGatewayIpcAdapter` and kept gateway runtime methods focused on orchestration/session lifecycle.
- **Removed legacy global runtime wiring**: replaced `global`-based access (`gateway` / `settingsService`) with explicit dependency injection for event publishing and feedback waiting.
- **Stabilized session lifecycle behavior**: fixed duplicate `agent:event` fan-out, clarified stop/abort completion semantics, and kept UI-ready signaling deterministic.
- **Added backend regression and extreme test scripts**: introduced focused coverage for feedback races, stop/restart lifecycle, IPC delegation completeness, and architecture boundary audits.

**WebSocket Gateway Adapter Skeleton**

- **Added websocket adapter layer for Gateway runtime**: introduced `WebSocketGatewayAdapter` + `WebSocketClientTransport` as protocol adapters around `IGatewayRuntime`.
- **Enabled optional websocket startup from composition root**: backend can now open a websocket endpoint via `GYSHELL_WS_ENABLE`, `GYSHELL_WS_HOST`, and `GYSHELL_WS_PORT`.
- **Exposed minimal remote control surface for non-Electron clients**: session lifecycle calls, task start/stop, feedback submission, terminal listing, and model profile selection (select-only).
- **Removed temporary CLI TUI test frontend**: kept websocket runtime capability while removing the transient test-only client entrypoint.

---

### 中文 (Chinese)

**Mention 输入行为**

- **调整 `@mention` 触发规则**：现在输入 `@` 即可触发 mention 建议，不再要求前置空格。
- **保持 mention 序列化/解析协议不变**：只有选中的 mention 标签会被转换为 `[MENTION_...]`；普通 `@` 文本仍按普通文本处理。
- **修复相邻 mention 的删除行为**：当两个 mention 标签连续出现时，在重新匹配状态下删除只会移除当前目标标签，不会一次删掉两个。

**后端 Gateway 解耦**

- **将 Gateway 重构为与传输层无关的运行时核心**：把多客户端分发抽离到 `TransportHub`，移除 `GatewayService` 对 Electron 传输实现的直接耦合。
- **将 Electron IPC 注册拆分为独立适配器**：IPC 入口迁移到 `ElectronGatewayIpcAdapter`，Gateway 本体只保留编排与会话生命周期职责。
- **移除 legacy 全局注入路径**：将 `global` 访问（`gateway` / `settingsService`）替换为明确的依赖注入（事件发布与反馈等待）。
- **强化会话生命周期一致性**：修复 `agent:event` 重复分发问题，明确 stop/abort 收尾行为，保持 UI ready 信号可预测。
- **补充后端回归与极端测试脚本**：覆盖反馈竞态、stop/restart 生命周期、IPC 委托完整性和架构边界静态审计。

**WebSocket Gateway Adapter 骨架**

- **新增 Gateway 的 WebSocket 适配层**：引入 `WebSocketGatewayAdapter` 与 `WebSocketClientTransport`，作为 `IGatewayRuntime` 外围协议适配。
- **在组合根加入可选 WebSocket 启动机制**：通过 `GYSHELL_WS_ENABLE`、`GYSHELL_WS_HOST`、`GYSHELL_WS_PORT` 控制后端是否对外开启 websocket。
- **为非 Electron 前端暴露最小远程能力面**：包含会话生命周期、任务启动/停止、反馈提交、terminal 列表、模型 profile 选择（仅切换不新增）。
- **移除临时 CLI TUI 测试前端**：保留 websocket 运行时能力，同时删除仅用于阶段测试的客户端入口。
